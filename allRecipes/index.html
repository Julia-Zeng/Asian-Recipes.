<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <title>All Recipes</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = 'https://ytbfokayjuwdovzygubt.supabase.co/';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl0YmZva2F5anV3ZG92enlndWJ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA0NTMyNDAsImV4cCI6MjA3NjAyOTI0MH0.lZv12D29lHDWYvmmolZbGBjuB6JMwdZB1SVIE52YmVg';
    const db = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  </script>
</head>

<body>
  <div class="sidebar">
    <h3 class="sidebar-title" href="#">Menu Bar</h3>
    <a href="../allRecipes/index.html">All Recipes</a>
    <a href="../myAccount/index.html">My Account</a>
    <a href="../myRecipes/index.html">My Recipes</a>
  </div>

  <div class="searchbar">
    <div class="search-container">
      <input type="text" placeholder="Search.." name="search" oninput="searchRecipe(event)"
        onblur="closeSearchResults()">
      <div id="recipe-results-container"></div>
    </div>
  </div>
  <a href="../HomePage/index.html"><img class="home-button" src="../Images/home.png" alt=""></a>

  <div class="content">
    <div class="header">
      <h1>
        All Recipes
      </h1>
      <div id="recipe-container" class="recipe-container">

      </div>
    </div>
</body>
<script>
  async function fetchRecipes() {
    const { data, error } = await db
      .from('Recipes')
      .select('*')
      .order('title', { ascending: true });

    if (error) {
      console.error('Error fetching recipes:', error);
    } else {
      console.log('Recipes:', data);
      // You can add code here to dynamically display recipes on the homepage
      const recipeContainer = document.getElementById('recipe-container');
      recipeContainer.innerHTML = ''; // Clear existing content
      data.forEach(recipe => {
        const recipeDiv = document.createElement('div');
        recipeDiv.className = 'dumplings-container';
        recipeDiv.innerHTML = `
                    <a href="../recipeDetails/index.html?id=${recipe.id}">
                        <img src="${recipe.image}" alt="${recipe.title} image">
                    </a>
                    <h4>${recipe.title}</h4>
                `;
        recipeContainer.appendChild(recipeDiv);
      });
    }
  }
  fetchRecipes();
  async function searchRecipe(event) {
    const query = event.target.value;
    if (query.length === 0) {
      document.getElementById('recipe-results-container').innerHTML = '';
      document.getElementById('recipe-results-container').style.display = 'none';
      return;
    }
    const { data, error } = await db
      .from('Recipes')
      .select('*')
      .ilike('title', `%${query}%`)
      .order('title', { ascending: true });

    if (error) {
      console.error('Error searching recipes:', error);
    } else {
      console.log('Search results:', data);
      const resultsContainer = document.getElementById('recipe-results-container');
      resultsContainer.innerHTML = ''; // Clear previous results
      if (data.length > 0) {
        resultsContainer.style.display = 'block';
      } else {
        resultsContainer.style.display = 'none';
        return;
      }
      data.forEach(recipe => {
        const resultDiv = document.createElement('div');
        resultDiv.className = 'search-result';
        resultDiv.innerHTML = `
                <h4 onmousedown="navigateToRecipe(${recipe.id})" class="auto-complete-title">${recipe.title}</h4>
                `;
        resultsContainer.appendChild(resultDiv);
        const divider = document.createElement('hr');
        if (recipe !== data[data.length - 1]) {
          resultsContainer.appendChild(divider);
        }
      });
    }
  }
  function closeSearchResults() {
    document.getElementById('recipe-results-container').style.display = 'none';
  }
  function navigateToRecipe(recipeId) {
    window.location.href = `../recipeDetails/index.html?id=${recipeId}`;
  }
</script>

</html>